<#include "/lib/layout.html">

<@layout_std page="validationRun" script=true title="#${validationRun.indexNb?string}"
    modules=["projects","branches","builds","validation_stamps","audit"]
    breadcrumbs = {
        loc("home"): "",
        validationRun.build.branch.project.name?html:
            "gui/project/${validationRun.build.branch.project.name?html}",
        validationRun.build.branch.name?html:
            "gui/branch/${validationRun.build.branch.project.name?html}/${validationRun.build.branch.name?html}",
        validationRun.validationStamp.name?html:
            "gui/validation_stamp/${validationRun.build.branch.project.name?html}/${validationRun.build.branch.name?html}/${validationRun.validationStamp.name?html}"}>
	<div class="container-fluid">
        <input id="validationRunId" type="hidden" value="${validationRun.id}" />
		<div class="row-fluid">
            <div class="span12 page-title">
                <span class="title">
                    <a href="gui/project/${validationRun.build.branch.project.name?html}">${validationRun.build.branch.project.name?html}</a>
                    / <a href="gui/branch/${validationRun.build.branch.project.name?html}/${validationRun.build.branch.name?html}">${validationRun.build.branch.name?html}</a>
                    / <a href="gui/build/${validationRun.build.branch.project.name?html}/${validationRun.build.branch.name?html}/${validationRun.build.name?html}">${validationRun.build.name?html}</a>
                    / <a href="gui/validation_stamp/${validationRun.build.branch.project.name?html}/${validationRun.build.branch.name?html}/${validationRun.validationStamp.name?html}"><@validation_stamp_img validationStamp=validationRun.validationStamp /> ${validationRun.validationStamp.name?html}</a>
                / #${validationRun.indexNb?html}</span>
                <span class="action action-optional">
                    <#if secAdmin()>
                        <span onclick=""><i class="icon-pencil"></i> <@lh key="general.modify" /></span>
                        <span onclick=""><i class="icon-trash"></i> <@lh key="general.delete" /></span>
                    </#if>
                    <span onclick="location='gui/build/${validationRun.build.branch.project.name?html}/${validationRun.build.branch.name?html}/${validationRun.build.name?html}'"><i class="icon-remove"></i> <@lh key="general.close" /></span>
                </span>
            </div>
            <div class="span12 muted">${validationRun.description?html}</div>
        </div>
        <#if secLogged()>
            <div class="row-fluid">
                <div class="span12">
                    <button class="btn btn-link" onclick="ValidationRun.updateStatus()"><i class="icon-comment"></i> <@lh key="validationRunStatus.new" /></button>
                    <@form id="status-form" class="x-dialog alert alert-info">
                        <@form_memo name="description" label="" class="input-block-level" placeholder=loc("validationRunStatus.description") maxlength=1000 />
                        <@form_select name="status" label="">
                        <@form_select_option value="" text=loc("validationRunStatus.status.none") />
                            <#list modelStatusList() as status>
                                <@form_select_option value=status text=status />
                            </#list>
                        </@form_select>
                        <div id="status-error" class="x-error alert alert-error"></div>
                        <@form_buttons>
                            <button type="submit" class="btn btn-primary"><@lh key="general.submit" /></button>
                            <button type="button" class="btn btn-link" onclick="ValidationRun.cancelUpdateStatus()"><@lh key="general.cancel" /></button>
                        </@form_buttons>
                    </@form>
                </div>
            </div>
        </#if>
        <div class="row-fluid">
            <div class="span12">
                <@panel title=loc("event.list")>
                    <@audit filter="&validationRun=${validationRun.id}" />
                </@panel>
            </div>
		</div>
	</div>
</@layout_std>