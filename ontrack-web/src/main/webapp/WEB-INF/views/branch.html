<#include "/lib/layout.html">

<@layout_std page="branch" title=branch.name modules=["projects","branches","builds","validation_stamps","promotion_levels","audit","properties"] breadcrumbs = {loc("home"): "", branch.project.name?html: "gui/project/${branch.project.name?html}"}>
	<div class="container-fluid">
        <div class="row-fluid">
            <div class="span12 page-title">
                <span class="title"><a href="gui/project/${branch.project.name?html}">${branch.project.name?html}</a>
                / ${branch.name?html}</span>
                <span class="action action-optional">
                    <#if secAdmin()>
                        <span onclick="Branches.updateBranch('${branch.project.name?html}','${branch.name?html}')"><i class="icon-pencil"></i> <@lh key="general.modify" /></span>
                        <span onclick="Branches.cloneBranch('${branch.project.name?html}','${branch.name?html}')"><i class="icon-forward"></i> <@lh key="branch.clone" /></span>
                        <span onclick="Branches.deleteBranch('${branch.project.name?html}','${branch.name?html}')"><i class="icon-trash"></i> <@lh key="general.delete" /></span>
                        <a href="gui/project/${branch.project.name?html}/branch/${branch.name?html}/promotion_level_manage"><i class="icon-th"></i> <@lh key="promotion_level.manage" /></a>
                    </#if>
                    <a href="gui/project/${branch.project.name?html}"><i class="icon-remove"></i> <@lh key="general.close" /></a>
                </span>
            </div>
            <div class="muted span12 properties">${branch.description?html}</div>
            <div class="span12 properties">
                <@properties entity="BRANCH" entityId=branch.id />
            </div>
        </div>
        <div class="row-fluid">
            <div class="span12">
                <@builds project=branch.project.name branch=branch.name />
            </div>
        </div>
        <div class="row-fluid">
			<div class="span3">
				<@panel title=loc("branch.promotion_levels")>
                    <@promotion_levels project=branch.project.name branch=branch.name create=secAdmin() />
				</@panel>
            </div>
            <div class="span3">
				<@panel title=loc("branch.validation_stamps")>
					<@validation_stamps project=branch.project.name branch=branch.name create=secAdmin() />
				</@panel>
			</div>
			<div class="span6">
				<@audit filter="&branch=${branch.id}" />
			</div>
		</div>
	</div>

    <@dialog id="branch-update-dialog">
        <@form_text idPrefix="branch-update-dialog-" name="name" label=loc('branch.name') />
        <@form_memo idPrefix="branch-update-dialog-" name="description" label=loc('branch.description') required=false />

        <@dialog_button id="branch-update-dialog-submit" class="btn-primary" text=loc('general.modify') />
        <@dialog_button_cancel />
    </@dialog>

    <@dialog id="branch-clone-dialog">
        <@form_text idPrefix="branch-clone-dialog-" name="name-original" label=loc('branch.clone.original') extra='readonly="readonly"' />
        <@form_text idPrefix="branch-clone-dialog-" name="name" label=loc('branch.name') />
        <@form_memo idPrefix="branch-clone-dialog-" name="description" label=loc('branch.description') required=false />

        <@dialog_button id="branch-clone-dialog-submit" class="btn-primary" text=loc('branch.clone') />
        <@dialog_button_cancel />
    </@dialog>
</@layout_std>