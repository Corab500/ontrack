<#include "/lib/layout.html">

<#assign validationStamp = decoratedValidationStamp.summary />

<@layout_std page="validation_stamp" title=validationStamp.name modules=["projects","branches","builds","validation_stamps","audit","properties"] breadcrumbs = {loc("home"): "", validationStamp.branch.project.name?html: "gui/project/${validationStamp.branch.project.name?html}", validationStamp.branch.name?html: "gui/project/${validationStamp.branch.project.name?html}/branch/${validationStamp.branch.name?html}"}>
	<div class="container-fluid">
        <div class="row-fluid">
            <div class="span12 page-title">
                <span class="title">
                    <a href="gui/project/${validationStamp.branch.project.name?html}">${validationStamp.branch.project.name?html}</a>
                    / <a href="gui/project/${validationStamp.branch.project.name?html}/branch/${validationStamp.branch.name?html}">${validationStamp.branch.name?html}</a>
                    / <@validation_stamp_img validationStamp=validationStamp /> ${validationStamp.name?html}
                    <#list decoratedValidationStamp.decorations as decoration>
                        <img src="${decoration.iconPath}" title="${decoration.title?html}" class="tooltip-source" />
                    </#list>
                </span>
                <span class="action action-optional">
                    <#if secAdmin()>
                        <span onclick="ValidationStamps.updateValidationStamp('${validationStamp.branch.project.name?html}','${validationStamp.branch.name?html}','${validationStamp.name?html}')"><i class="icon-pencil"></i> <@lh key="general.modify" /></span>
                        <span onclick="ValidationStamps.editImage();"><i class="icon-edit"></i> <@lh key="validation_stamp.image.edit" /></span>
                        <span onclick="ValidationStamps.changeOwnerInPage('${validationStamp.branch.project.name?html}','${validationStamp.branch.name?html}','${validationStamp.name?html}');"><i class="icon-user"></i> <@lh key="validation_stamp.owner.change" /></span>
                        <a href="gui/project/${validationStamp.branch.project.name?html}/branch/${validationStamp.branch.name?html}/promotion_level_manage"><i class="icon-th"></i> <@lh key="promotion_level.manage" /></a>
                        <span onclick="ValidationStamps.deleteValidationStamp('${validationStamp.branch.project.name?html}','${validationStamp.branch.name?html}','${validationStamp.name?html}')"><i class="icon-trash"></i> <@lh key="general.delete" /></span>
                    </#if>
                    <a href="gui/project/${validationStamp.branch.project.name?html}/branch/${validationStamp.branch.name?html}"><i class="icon-remove"></i> <@lh key="general.close" /></a>
                </span>
            </div>
            <div class="span12 properties description">${validationStamp.description?html}</div>
            <#if validationStamp.owner??>
                <ul class="span12 properties">
                    <li>
                        <img src="${base}/images/owner.png" width="24" height="24" />
                        <span class="description"><@lh key="validation_stamp.owner" />:</span>
                        ${validationStamp.owner.fullName?html} - <code>${validationStamp.owner.name?html}</code>
                    </li>
                </ul>
            </#if>
            <div class="span12 properties">
                <@properties entity="VALIDATION_STAMP" entityId=validationStamp.id />
            </div>
        </div>
        <div id="validation_stamp-image-form" class="row-fluid x-dialog">
            <form class="span4 alert alert-info" method="POST" enctype="multipart/form-data" action="gui/project/${validationStamp.branch.project.name?html}/branch/${validationStamp.branch.name?html}/validation_stamp/${validationStamp.name?html}/image">
                <input id="validation_stamp.image.file" name="image" type="file" accept=".png,image/png" required="required" placeholder="<@lh key='validation_stamp.image.placeholder'/>" />
                <p class="help-block"><@lh key="validation_stamp.image.help" /></p>
                <button id="validation_stamp.image.submit" type="submit" class="btn btn-primary"><@lh key="general.submit"/></button>
                <button id="validation_stamp.image.cancel" type="button" class="btn btn-link" onclick="ValidationStamps.editImageCancel()"><@lh key="general.cancel"/></button>
            </form>
            <div class="span12 muted">${validationStamp.description?html}</div>
        </div>
		<div class="row-fluid">
            <div class="span6">
                <h4>
                    <@lh key="validation_stamp.comments" />
                    <#if secLogged()>
                        <img src="${base}/images/comment_add.png" onclick="$('#validation-stamp-comment-form').toggle();$('#validation-stamp-comment').focus();" class="action" title="<@lh key='validation_stamp.comment.add' />" />
                    </#if>
                </h4>
                <#if secLogged()>
                    <form id="validation-stamp-comment-form" class="hidden" onsubmit="return ValidationStamps.addComment();">
                        <input type="hidden" id="validation-stamp-comment-project" value="${validationStamp.branch.project.name?html}" />
                        <input type="hidden" id="validation-stamp-comment-branch" value="${validationStamp.branch.name?html}" />
                        <input type="hidden" id="validation-stamp-comment-validationStamp" value="${validationStamp.name?html}" />
                        <div class="input-append">
                            <textarea id="validation-stamp-comment" name="comment" class="span9" rows="1" required="required"></textarea>
                            <button id="validation-stamp-comment-submit" type="submit" class="btn"><@lh key="validation_stamp.comment.add" /></button>
                            <button type="button" class="btn btn-link" onclick="$('#validation-stamp-comment-form').toggle();"><@lh key="general.cancel" /></button>
                        </div>
                    </form>
                </#if>
                <@dynamicsection id="validation-stamp-comments" template="ValidationStamps.commentsTemplate('${validationStamp.branch.project.name?html}', '${validationStamp.branch.name?html}', '${validationStamp.name?html}')" />
                <script id="validation-stamp-comment-template" type="text/html">
                    <tr>
                        <td>
                            <span>{{{comment}}}</span>
                            <span class="elapsed">- <span title="{{signature.formattedTime}}">{{signature.elapsedTime}}</span></span>
                        </td>
                    </tr>
                </script>
            </div>
			<div class="span6">
                <@audit filter="&validationStamp=${validationStamp.id}" />
			</div>
		</div>
	</div>

    <@dialog id="validation_stamp-update-dialog">
        <@form_text idPrefix="validation_stamp-update-dialog-" name="name" label=loc('validation_stamp.name') />
        <@form_memo idPrefix="validation_stamp-update-dialog-" name="description" label=loc('validation_stamp.description') required=false />

        <@dialog_button id="validation_stamp-update-dialog-submit" class="btn-primary" text=loc('general.modify') />
        <@dialog_button_cancel />
    </@dialog>

    <@validation_stamp_owner_dialog />
        
</@layout_std>