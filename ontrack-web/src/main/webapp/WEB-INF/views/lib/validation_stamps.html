<script type="text/javascript" src="${base}/js/validation_stamps.js"></script>
<link rel="stylesheet" type="text/css" href="${base}/css/validation_stamps.css" />

<#macro validation_stamps project branch id="validation_stamps" create=true>
	<@dynamicsection id=id template="ValidationStamps.validationStampTemplate('${project?html}','${branch?html}')">
		<#if create>
			<@dialog id="validation_stamp-create-dialog">
				<@form_text name="name" label=loc('validation_stamp.name') />
				<@form_memo name="description" label=loc('validation_stamp.description') required=false />
				
				<@dialog_button id="validation_stamp-create-dialog-submit" class="btn-primary" text=loc('general.create') />
                <@dialog_button_cancel />
            </@dialog>
			<button id="validation_stamp-create-button" type="button" class="btn" onclick="ValidationStamps.createValidationStamp('${project?html}','${branch?html}')"><@lh key="validation_stamp.create" /></button>
		</#if>
	</@dynamicsection>
    <script id="validationStampTemplate" type="text/html">
        <tr>
            <td>
                <img width="24" height="24" src="gui/project/{{branch.project.name}}/branch/{{branch.name}}/validation_stamp/{{name}}/image" />
                <a href="gui/project/{{branch.project.name}}/branch/{{branch.name}}/validation_stamp/{{name}}">{{name}}</a>
                <!-- Owner -->
                {{#owner}}
                    <span class="description">({{fullName}})</span>
                {{/owner}}
                <#if secAdmin()>
                    {{^first}}
                        <i class="icon-arrow-up action validation-stamp-order" onclick="ValidationStamps.down('{{branch.project.name}}', '{{branch.name}}', '{{name}}');"></i>
                    {{/first}}
                    {{^last}}
                        <i class="icon-arrow-down action validation-stamp-order" onclick="ValidationStamps.up('{{branch.project.name}}', '{{branch.name}}', '{{name}}');"></i>
                    {{/last}}
                    <div id="validation-stamp-{{name}}-order-loading" class="hidden"></div>
                    <!-- Ownership -->
                    <i class="icon-user action action-optional" title="<@lh key='validation_stamp.owner.change' />" onclick="ValidationStamps.changeOwnerInList('{{branch.project.name}}', '{{branch.name}}', '{{name}}');"></i>
                </#if>
                {{#description}}
                    <br/>
                    <span class="description">{{description}}</span>
                {{/description}}
            </td>
        </tr>
    </script>
    <@validation_stamp_owner_dialog />
</#macro>

<#macro validation_stamp_owner_dialog>
    <@dialog id="validation_stamp-owner-dialog">
        <@form_text idPrefix="validation_stamp-owner-dialog-" name="name" label=loc('model.validation_stamp') extra='readOnly="readOnly"' />
        <@form_select idPrefix="validation_stamp-owner-dialog-" name="owner" label=loc('validation_stamp.owner')>
        </@form_select>

        <@dialog_button id="validation_stamp-owner-dialog-submit" class="btn-primary" text=loc('general.modify') />
        <@dialog_button_cancel />
    </@dialog>
</#macro>

<#macro validation_stamp_img validationStamp>
	<img width="24" title="${validationStamp.name?html}" src="gui/project/${validationStamp.branch.project.name?html}/branch/${validationStamp.branch.name?html}/validation_stamp/${validationStamp.name?html}/image" />
</#macro>

<#macro validation_stamp_link validationStamp>
    <a href="gui/project/${validationStamp.branch.project.name?html}/branch/${validationStamp.branch.name?html}/validation_stamp/${validationStamp.name?html}">${validationStamp.name?html}</a>
</#macro>