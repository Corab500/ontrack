<script type="text/javascript" src="${base}/js/builds.js"></script>
<link rel="stylesheet" type="text/css" href="${base}/css/builds.css" />

<#macro builds project branch id="builds">
	<@dynamicsection id=id template="Builds.buildTemplate('${project?html}','${branch?html}')">
	</@dynamicsection>

    <script id="branchBuildsTemplate" type="text/html">
        <table class="table">
            <thead>
                <tr>
                    <th rowspan="2"><@lh key="model.build" /></th>
                    <th rowspan="2"><@lh key="branch.promotion_levels" /></th>
                    <th colspan="{{branchBuilds.validationStamps.length}}"><@lh key="branch.validation_stamps" /></th>
                </tr>
                <tr>
                    {{#branchBuilds.validationStamps}}
                        <th align="center" class="validation_stamp_header" validation_stamp="{{name}}">
                            <a href="gui/project/{{../project}}/branch/{{branch.name}}/validation_stamp/{{name}}">
                                <img class="tooltip-source" width="24" title="{{name}}" src="gui/project/{{../project}}/branch/{{branch.name}}/validation_stamp/{{name}}/image" />
                            </a>
                        </th>
                    {{/branchBuilds.validationStamps}}
                </tr>
            </thead>
            <tbody>
                {{{rowFn}}}
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="{{totalColspan}}">
                        <button id="more-builds" type="button" class="btn" onclick="Template.more('builds')"><@lh key="general.more" /></button>
                    </td>
                </tr>
            </tfoot>
        </table>
    </script>

    <script id="branchBuildsRowTemplate" type="text/html">
        {{#branchBuilds.builds}}
            <tr>
                <td class="branch-build build_header" build="{{name}}">
                    <a
                            class="tooltip-source"
                            href="gui/project/{{../project}}/branch/{{../branch}}/build/{{name}}"
                            title="{{description}} - {{signature.elapsedTime}} - {{formattedTime}}">
                        {{name}}
                    </a>
                </td>
                <td class="build_promotion_level" build="{{name}}">
                    {{#promotionLevelsFn}}{{/promotionLevelsFn}}
                </td>
            </tr>
        {{/branchBuilds.builds}}
    </script>

    <script id="promotionLevelsTemplate" type="type/html">
        {{#if promotionLevels.length}}
            <ul class="promotions">
                {{#promotionLevels}}
                    <li>
                        <i class="icon-arrow-right"></i>
                        <img width="24" src="gui/project/{{../project}}/branch/{{../branch}}/promotion_level/{{name}}/image" />
                        <a class="tooltip-source" href="gui/project/{{../project}}/branch/{{../branch}}/promotion_level/{{name}}" title="{{signature.elapsedTime}} - {{signature.formattedTime}}">{{name}}</a>
                    </li>
                {{/promotionLevels}}
            </ul>
        {{else}}
            <span class="muted"><@lh key="build.promotion_levels.none" /></span>
        {{/if}}
    </script>

</#macro>
